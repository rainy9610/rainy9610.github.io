<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸŒ å…¨çƒå³æ™‚å½±åƒç›£æ§å„€è¡¨æ¿</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <style>
        /* 1. å…¨åŸŸæ¨£å¼èˆ‡é‡ç½® */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { height: 100%; width: 100%; overflow-x: hidden; font-family: "Microsoft JhengHei", sans-serif; background-color: #f4f7f6; }

        /* 2. è—å¤©æ¨™é¡Œå€å¡Š */
        #sky-header {
            height: 60vh;
            background: linear-gradient(to bottom, #4FA4E4 0%, #CAE5F7 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            text-shadow: 2px 2px 8px rgba(0,0,0,0.3);
            text-align: center;
            padding: 20px;
        }

        h1 { font-size: 3rem; margin-bottom: 10px; }
        p { font-size: 1.2rem; opacity: 0.9; }

        /* éš¨æ©Ÿå‚³é€æŒ‰éˆ•æ¨£å¼ */
        .btn-random {
            margin-top: 30px;
            padding: 15px 35px;
            font-size: 1.3rem;
            background: #ff7800;
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            font-weight: bold;
        }
        .btn-random:hover {
            background: #e66a00;
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }

        /* 3. åœ°åœ–å®¹å™¨ä¿®æ­£ (é˜²æ­¢ç©ºç™½é—œéµ) */
        #map-container {
            position: relative;
            height: 800px;
            width: 100%;
            border-top: 6px solid #578F59;
            box-shadow: 0 -5px 15px rgba(0,0,0,0.1);
        }
        #map { height: 100%; width: 100%; background-color: #f0f0f0; }

        /* 4. å½ˆå‡ºè¦–çª—å¯¬åº¦å¼·åˆ¶ä¿®æ­£ */
        .leaflet-popup-content { width: 450px !important; margin: 15px !important; }
        .leaflet-popup-content-wrapper { border-radius: 12px; width: 480px !important; padding: 0; overflow: hidden; }
        
        /* 5. å‘¼å¸å‹•ç•« (è®“åœ–é‡˜é–ƒçˆå¢åŠ å‹•æ…‹æ„Ÿ) */
        @keyframes pulse {
            0% { transform: scale(1); opacity: 0.8; }
            50% { transform: scale(1.2); opacity: 0.6; }
            100% { transform: scale(1); opacity: 0.8; }
        }
        .leaflet-interactive { animation: pulse 3s infinite ease-in-out; }

        iframe { border-radius: 8px; display: block; background: #000; }
    </style>
</head>
<body>

    <header id="sky-header">
        <h1>ğŸŒ å…¨çƒå³æ™‚å½±åƒåœ°åœ–</h1>
        <p>è·¨è¶Šæ™‚å€ï¼Œå³æ™‚æ¢ç´¢ä¸–ç•Œæ¯å€‹è§’è½</p>
        <button class="btn-random" onclick="randomFly()">âœ¨ å¸¶æˆ‘å»å†’éšª (éš¨æ©Ÿå‚³é€)</button>
    </header>

    <div id="map-container">
        <div id="map"></div>
    </div>
    
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
    // 1. åˆå§‹åŒ–åœ°åœ–
    var map = L.map('map').setView([20, 0], 2); 

    // 2. è¼‰å…¥åœ°åœ–åº•åœ–
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: 'Â© OpenStreetMap contributors' 
    }).addTo(map);

    // 3. æ•´åˆå¾Œçš„ 17 å€‹åœ°é»è³‡æ–™
    var locations = [
        { name: "ğŸ‡¹ğŸ‡¼ å°ä¸­ æœ›é«˜å¯®å¤œæ™¯", lat: 24.1432, lng: 120.5750, video: "lhXXhDYjFtI", tz: "Asia/Taipei" },
        { name: "ğŸ‡¹ğŸ‡¼ å°åŒ— å¤§ç¨»åŸ•ç¢¼é ­", lat: 25.0569, lng: 121.5065, video: "Ndo_8RuefH4", tz: "Asia/Taipei" },
        { name: "ğŸ‡¹ğŸ‡¼ é«˜é›„ å£½å±±è§€æ™¯å°", lat: 22.6225, lng: 120.2798, video: "C03Itx8iSC0", tz: "Asia/Taipei" },
        { name: "ğŸ‡¹ğŸ‡¼ å°ç£ å°æ±", lat: 22.7937, lng: 121.0560, video: "UCG1aXVO8H8", tz: "Asia/Taipei" },
        { name: "ğŸ‡³ğŸ‡± è·è˜­ é˜¿å§†æ–¯ç‰¹ä¸¹", lat: 52.3731, lng: 4.8926, video: "Gd9d4q6WvUY", tz: "Europe/Amsterdam" },
        { name: "ğŸ‡¦ğŸ‡º æ¾³æ´² é›ªæ¢¨æ¸¯", lat: -33.8688, lng: 151.2093, video: "5uZa3-RMFos", tz: "Australia/Sydney" },
        { name: "ğŸ‡ºğŸ‡¸ ç¾åœ‹ ç´å¥§è‰¯ (è·¯æ˜“æ–¯å®‰é‚£)", lat: 29.9511, lng: -90.0715, video: "86-7Dr7yeVQ", tz: "America/Chicago" },
        { name: "ğŸ‡¹ğŸ‡­ æ³°åœ‹ è˜‡æ¢…å³¶", lat: 9.4673, lng: 100.0610, video: "Fw9hgttWzIg", tz: "Asia/Bangkok" },
        { name: "ğŸ‡ºğŸ‡¸ ç¾åœ‹ ç´ç´„ (æ™‚å ±å»£å ´)", lat: 40.7580, lng: -73.9855, video: "rnXIjl_Rzy4", tz: "America/New_York" },
        { name: "ğŸ‡«ğŸ‡® èŠ¬è˜­ åŸºçˆ¾çš®æ–¯è€¶çˆ¾ç¶­ (æ¥µå…‰)", lat: 69.0494, lng: 20.7891, video: "ccTVAhJU5lg", tz: "Europe/Helsinki" },
        { name: "ğŸ‡«ğŸ‡® èŠ¬è˜­ ç¾…ç“¦æ¶…ç±³ (è–èª•æ‘)", lat: 66.5039, lng: 25.7294, video: "Cp4RRAEgpeU", tz: "Europe/Helsinki" },
        { name: "ğŸ‡¨ğŸ‡­ ç‘å£« å·´å¡çˆ¾", lat: 47.5596, lng: 7.5886, video: "jtLh8BdmHUU", tz: "Europe/Zurich" },
        { name: "ğŸ‡®ğŸ‡¹ ç¾©å¤§åˆ© å¨å°¼æ–¯", lat: 45.4408, lng: 12.3155, video: "WjOGhNDX51M", tz: "Europe/Rome" },
        { name: "ğŸ‡ºğŸ‡¸ ç¾åœ‹ å‚‘å…‹éœ (æ‡·ä¿„æ˜å·)", lat: 43.4799, lng: -110.7628, video: "1EiC9bvVGnk", tz: "America/Denver" },
        { name: "ğŸ‡¯ğŸ‡µ æ—¥æœ¬ æœ­å¹Œ (åŒ—æµ·é“)", lat: 43.0621, lng: 141.3544, video: "CF1vS8DdBIk", tz: "Asia/Tokyo" },
        { name: "ğŸ‡¯ğŸ‡µ æ—¥æœ¬ æ­Œèˆä¼ç”º (æ±äº¬)", lat: 35.6938, lng: 139.7036, video: "gFRtAAmiFbE", tz: "Asia/Tokyo" },
        { name: "ğŸ‡°ğŸ‡· éŸ“åœ‹ å¼˜å¤§ (é¦–çˆ¾)", lat: 37.5574, lng: 126.9246, video: "S1A49C6V-dg", tz: "Asia/Seoul" }
    ];

    var markerList = [];

    // 4. æŠ“å–å¤©æ°£ API å‡½æ•¸
    async function getWeatherData(lat, lng) {
        try {
            const response = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lng}&current_weather=true`);
            const data = await response.json();
            return data.current_weather.temperature;
        } catch (error) { return "--"; }
    }

    // 5. ç¹ªè£½æ‰€æœ‰åœ°é»æ¨™è¨˜
    locations.forEach(async function(loc) {
        // æŠ“å–å³æ™‚å¤©æ°£èˆ‡æ™‚é–“
        const currentTemp = await getWeatherData(loc.lat, loc.lng);
        var localTime = new Date().toLocaleString("zh-TW", {
            timeZone: loc.tz,
            hour: '2-digit', minute: '2-digit', hour12: false
        });

        var content = `
            <div style="width: 450px; padding: 5px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; border-bottom: 2px solid #eee; padding-bottom: 8px;">
                    <h4 style="margin: 0; font-size: 18px; color: #333;">${loc.name}</h4>
                    <div style="text-align: right;">
                        <span style="background: #444; color: white; padding: 3px 8px; border-radius: 4px; font-size: 12px; margin-right: 8px;">ğŸ•’ ${localTime}</span>
                        <span style="color: #ff4500; font-weight: bold; font-size: 18px;">ğŸŒ¡ï¸ ${currentTemp}Â°C</span>
                    </div>
                </div>
                <iframe width="450" height="300" src="https://www.youtube.com/embed/${loc.video}" frameborder="0" allowfullscreen></iframe>
            </div>`;
        
        // ä½¿ç”¨åœ“é»æ¨™è¨˜ (é¿å…åœ–ç‰‡ä¸Ÿå¤±å•é¡Œ)
        var marker = L.circleMarker([loc.lat, loc.lng], {
            radius: 11,
            fillColor: "#ff7800",
            color: "#fff",
            weight: 3,
            fillOpacity: 0.9
        }).addTo(map).bindPopup(content, { maxWidth: 500, minWidth: 450 });

        markerList.push(marker);
    });

    // 6. éš¨æ©Ÿå‚³é€å‡½æ•¸
    function randomFly() {
        if (markerList.length === 0) return;
        var randomIndex = Math.floor(Math.random() * markerList.length);
        var targetMarker = markerList[randomIndex];
        
        // é£›è¡Œæ•ˆæœ
        map.flyTo(targetMarker.getLatLng(), 11, { animate: true, duration: 2.5 });

        // é£›è¡Œå®Œæˆå¾Œè‡ªå‹•æ‰“é–‹ Popup
        map.once('moveend', function() {
            targetMarker.openPopup();
        });

        // é é¢æ»¾å‹•åˆ°åœ°åœ–å€
        document.getElementById('map-container').scrollIntoView({ behavior: 'smooth' });
    }

    // 7. è‡ªå‹•å°ç„¦å…¨é«”åœ–æ¨™ä¸¦ä¿®æ­£å¤§å°
    var bounds = L.latLngBounds(locations.map(l => [l.lat, l.lng]));
    map.fitBounds(bounds, { padding: [50, 50] });
    setTimeout(function(){ map.invalidateSize()}, 1000);
    </script>
</body>
</html>
