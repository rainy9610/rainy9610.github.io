<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸŒ å…¨çƒå„åœ°å³æ™‚å½±åƒ - è—å¤©ä¸‹çš„åœ°åœ–</title>
    
    <link rel="stylesheet" href="leaflet.css" />

    <style>
    /* 1. åŸºæœ¬é‡ç½® */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { height: 100%; width: 100%; overflow-x: hidden; }

    /* 2. ä¸Šæ–¹è—å¤©å€å¡Š */
    #sky-header {
        height: 60vh;
        background: linear-gradient(to bottom, #4FA4E4 0%, #CAE5F7 100%);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        color: white;
        text-shadow: 2px 2px 5px rgba(0,0,0,0.2);
    }

    /* 3. ä¸‹æ–¹åœ°åœ–å®¹å™¨ï¼šè§£æ±ºç©ºç™½å•é¡Œçš„é—œéµ */
    #map-container {
        position: relative;
        height: 800px; /* å¼·åˆ¶çµ¦äºˆä¸€å€‹å›ºå®šé«˜åº¦ï¼Œé˜²æ­¢è®Šç©ºç™½ */
        width: 100%;
        border-top: 5px solid #578F59;
    }

    #map { 
        height: 100%; 
        width: 100%; 
        background-color: #f0f0f0; /* çµ¦äºˆåº•è‰²ç¢ºä¿è¼‰å…¥ä¸­ä¸å…¨ç™½ */
    }

    /* 4. å¼·åˆ¶ä¿®æ­£å½ˆå‡ºè¦–çª—å¤ªçª„çš„å•é¡Œ */
    .leaflet-popup-content {
        width: 450px !important; /* å¼·åˆ¶å¯¬åº¦ 450px */
        margin: 15px !important;
    }

    .leaflet-popup-content-wrapper {
        border-radius: 10px;
        width: 480px !important; /* åŒ…è£¹å±¤ä¹Ÿè¦å¤ å¯¬ */
    }

    iframe {
        border-radius: 5px;
        display: block;
    }
</style>
</head>
<body>

    <header id="sky-header">
        <h1>â˜ï¸ å…¨çƒå³æ™‚å½±åƒåœ°åœ– â˜ï¸</h1>
        <p>æ¢ç´¢ä¸–ç•Œå„åœ°çš„é¢¨æ™¯ï¼Œè«‹å¾€ä¸‹æ»‘å‹•åœ°åœ–</p>
    </header>

    <div id="map-container">
        <div id="map"></div>
    </div>
    
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
    <script>
    // 1. åˆå§‹åŒ–åœ°åœ–
    var map = L.map('map').setView([20, 0], 2); 

    // 2. è¼‰å…¥åœ°åœ–åº•åœ–
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: 'Â© OpenStreetMap' 
    }).addTo(map);

    // 3. åœ°é»è³‡æ–™ (åŒ…å«æ™‚å€ tz)
    var locations = [
        { name: "ğŸ‡¹ğŸ‡¼ å°ç£ å°æ±", lat: 22.7937, lng: 121.0560, video: "UCG1aXVO8H8", tz: "Asia/Taipei" },
        { name: "ğŸ‡«ğŸ‡® èŠ¬è˜­ ç¾…ç“¦æ¶…ç±³ (è–èª•è€äººæ‘)", lat: 66.5039, lng: 25.7294, video: "Cp4RRAEgpeU", tz: "Europe/Helsinki" },
        { name: "ğŸ‡¨ğŸ‡­ ç‘å£« å·´å¡çˆ¾", lat: 47.5596, lng: 7.5886, video: "jtLh8BdmHUU", tz: "Europe/Zurich" },
        { name: "ğŸ‡®ğŸ‡¹ ç¾©å¤§åˆ© å¨å°¼æ–¯", lat: 45.4408, lng: 12.3155, video: "WjOGhNDX51M", tz: "Europe/Rome" },
        { name: "ğŸ‡ºğŸ‡¸ ç¾åœ‹ å‚‘å…‹éœ (æ‡·ä¿„æ˜å·)", lat: 43.4799, lng: -110.7628, video: "1EiC9bvVGnk", tz: "America/Denver" },
        { name: "ğŸ‡¯ğŸ‡µ æ—¥æœ¬ æœ­å¹Œ (åŒ—æµ·é“)", lat: 43.0621, lng: 141.3544, video: "CF1vS8DdBIk", tz: "Asia/Tokyo" },
        { name: "ğŸ‡¯ğŸ‡µ æ—¥æœ¬ æ­Œèˆä¼ç”º (æ±äº¬)", lat: 35.6938, lng: 139.7036, video: "gFRtAAmiFbE", tz: "Asia/Tokyo" },
        { name: "ğŸ‡°ğŸ‡· éŸ“åœ‹ å¼˜å¤§ (é¦–çˆ¾)", lat: 37.5574, lng: 126.9246, video: "S1A49C6V-dg", tz: "Asia/Seoul" }
    ];

    // 4. å»ºç«‹æŠ“å–å¤©æ°£çš„å‡½æ•¸
    async function getWeatherData(lat, lng) {
        try {
            const response = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lng}&current_weather=true`);
            const data = await response.json();
            return data.current_weather.temperature;
        } catch (error) {
            console.error("å¤©æ°£æŠ“å–å¤±æ•—:", error);
            return "--"; 
        }
    }

    // 5. æ”¾ç½®æ¨™è¨˜ (å”¯ä¸€ä¸€å€‹è¿´åœˆï¼Œç¢ºä¿åŠŸèƒ½ä¸è¡çª)
    locations.forEach(async function(loc) {
        // A. ç²å–ç•¶åœ°æ™‚é–“
        var localTime = new Date().toLocaleString("zh-TW", {
            timeZone: loc.tz,
            hour: '2-digit', minute: '2-digit', hour12: false
        });

        // B. æŠ“å–å³æ™‚æ°£æº«
        const currentTemp = await getWeatherData(loc.lat, loc.lng);

        // C. çµ„åˆå½ˆå‡ºè¦–çª—å…§å®¹ (åŒ…å«æ™‚é–“ã€æ°£æº«èˆ‡ 450x300 å½±ç‰‡)
        var content = `
            <div style="width: 450px; font-family: sans-serif;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; border-bottom: 2px solid #eee; padding-bottom: 5px;">
                    <h4 style="margin: 0; font-size: 18px;">${loc.name}</h4>
                    <div style="text-align: right;">
                        <span style="background: #333; color: white; padding: 2px 6px; border-radius: 4px; font-size: 12px; margin-right: 5px;">ç•¶åœ°æ™‚é–“ ${localTime}</span>
                        <span style="color: #ff4500; font-weight: bold; font-size: 16px;">ğŸŒ¡ï¸ ${currentTemp}Â°C</span>
                    </div>
                </div>
                <iframe width="450" height="300" 
                    src="https://www.youtube.com/embed/${loc.video}" 
                    frameborder="0" allowfullscreen>
                </iframe>
            </div>`;
        
        // D. ç•«å‡ºåœ“é»æ¨™è¨˜
        L.circleMarker([loc.lat, loc.lng], {
            radius: 10,
            fillColor: "#ff7800",
            color: "#fff",
            weight: 2,
            fillOpacity: 0.8
        })
        .addTo(map)
        .bindPopup(content, { 
            maxWidth: 500, 
            minWidth: 450 
        });
    });

    // 6. è®“åœ°åœ–è‡ªå‹•å°ç„¦åˆ°æ‰€æœ‰é»
    var bounds = L.latLngBounds(locations.map(l => [l.lat, l.lng]));
    map.fitBounds(bounds, { padding: [50, 50] });

    // 7. ä¿®æ­£åœ°åœ–ç©ºç™½å•é¡Œ
    setTimeout(function(){ map.invalidateSize()}, 800);
</script></body>
</html>
